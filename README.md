# OA系统 Android+Spring
# OA文件下是项目的代码 其他的是平时作业
## 一、实验目的
学生能在实验中，熟练运用 Java 语言、Android、Web后端技术（Servlet）、数据库，开发一套基本完善的基于HTTP协议的移动APP。通过实验，学生能够掌握Android开发框架、开发方法及开发流程，掌握运用Android开发相关技术解决实际问题的开发能力。
## 二、实验内容
开发一套《在线课程申请及审批APP》，系统概要设计如下：
1.在线课程申请模块功能：
1.1学生登录功能
已有账号学生可以在线登录到申请系统中。
用户账户数据可预先存储到数据库中。
1.2在线申请功能
学生登录后，在可选课程列表中，选择要申请的课程。
每次申请只能选择一门课程，不可重复申请。
申请课程时，应填写必要的申请信息，如：申请原因、上传证明等。
课程详细数据可预先存储到数据库中。
1.3已申请课程，审批进度查询功能
审批过程中的申请可以进行进度查询。
审批状态有：申请已提交、课程主讲教师审批中、课程主管教师审批中、审批成功、申请驳回。
审批结束后，也就是审批状态为成功或者驳回，学生可以点击确认，完成本次申请。
结束本次申请后，在进度查询功能中不能再看到该条申请信息。
被驳回申请的课程，可线下沟通后，再次重新提交新的申请。
1.4已申请课程审批记录查询功能
学生可查询本人已申请的全部记录，包括审批通过和驳回的记录。
申请记录可使用分页显示，可使用多条件查询。
2.在线审批模块功能：
2.1课程申请审批功能
已有教师角色账号的教师可登录审批功能。
教师角色用户细分为：课程主讲教师和主管教师，主讲教师为该门课程的第一审批人，主管教师为第二审批人。
具体课程的主讲和主管教师对应关系数据，可预先存储到数据库中。
如果已提交的申请不符合申请条件，可以驳回，但驳回必须填写具体的原因，以便学生再次提交新的申请。
2.2已审批申请查询功能
教师可查询已审批的申请，查询结果可使用分页显示，可使用多条件查询。
3.额外功能：
在系统基本功能（实验内容1、2）基础之上，实现额外功能，使系统功能更加完善。
3.1后端数据访问
申请数据与审批数据需存储到后台的MySQL中，开发后端程序（Servlet）基于HTTP协议提供数据访问的API。
3.2后端接口访问
Android端需开发基于HTTP协议的后端接口访问功能。
4.拓展需求：
APP设计时需考虑到延展性、兼容性、可用性、通用性、健壮性，不仅能满足现有需要，也要适应未来发展的能力。
4.1适应健壮性，APP应充分考虑运行期间的各种异常情况并加以处理，保证运行时不出现异常或业务逻辑错误等重大问题
4.2适应兼容性，APP应使用SQLite存储用户数据
4.3适应通用性，应实现一般APP通用功能，
如：设置（切换APP显示风格、个人信息、退出、切换账号等）、通知等

## 三、实验环境
集成开发工具：IDEA、AndroidStudio
数据库：MySQL
操作系统：Windows
Web服务器：Tomcat

## 四、实验过程与分析
实验分析：
数据库设计分析：
分析数据库设计是否满足实验中的基本要求和额外功能的需求。
检查表之间的关系和约束是否正确，包括外键关联、主键定义、索引等。
分析数据库设计的合理性和性能，是否能够支持系统的数据操作和查询需求。
后端设计分析：
分析后端架构选择的合理性，如Spring Boot和Mybatis的使用。
检查后端数据访问和接口访问功能是否按照实验要求进行了实现。
分析后端设计的可扩展性和灵活性，是否方便进行功能的扩展和修改。
评估后端设计对系统性能、安全性和可靠性的影响。
前端设计分析：
分析前端界面设计的符合性，是否满足实验中的基本要求和用户需求。
检查前端逻辑流程的正确性和用户体验是否良好。
评估前端设计对系统性能和响应速度的影响。
分析前端代码的结构和组织方式，是否符合良好的设计原则和最佳实践。
设计原则应用分析：
分析设计中是否遵循了相关的设计原则，如单一职责原则、高内聚低耦合原则等。
评估设计原则的应用对系统的可维护性、可扩展性和可读性的影响。
分析设计中是否存在潜在的问题或改进的空间，如耦合度过高、职责不清晰等。
性能和用户体验分析：
进行系统性能测试，分析系统的响应速度、并发能力和资源利用率等方面的表现。
进行用户体验测试，收集用户反馈和意见，分析系统的易用性和用户满意度。
根据测试结果，评估系统在性能和用户体验方面的表现，是否需要进一步优化和改进。

实验过程：
1.数据库设计：首先根据实验中的基本要求，对数据库的内容进行设计，最开始设计出三张表：user（记录学生、老师、主管的信息和账号密码以及角色）、lesson（记录老师所教课程的基本信息）、oa（学生进行审批的内容，包含内外键与lesson和user表进行联系），此外在之后的需求分析中，还加入了两张表：singin（记录学生的签到信息）、exemption（记录学生免修申请的基本内容），最后每个数据库都设置了唯一的不重复的主键，解决了并发的问题。

![image](https://github.com/ShYyy121/OA/assets/145829122/1064524d-1a76-4408-9136-75a8c1d92ce3)

2.后端设计：根据实验中的基本要求，及额外功能中3.1和3.2的后端数据访问与后端接口访问，选择了Spring Boot + Mybatis的架构 ，在后端采用Mysql作为数据库，存储在其中，通过映射进行数据库中数据的操作，完成数据的增删改善等功能的实现，在前端规定对应的Api接口，向后端发送请求，完成对应的功能。同时利用spring框架中的spring security完成过滤的功能，保证了系统的安全性，只有有特定角色和权限的用户才可以访问对应的端口。

![image](https://github.com/ShYyy121/OA/assets/145829122/3f8b8dc6-a930-46c0-8089-73902f2f528a)

3.前端设计：根据实验中的基本要求，设计基本的界面和逻辑流程，同时结合SharedPreferences和SQLite数据库，实现本地数据的存储，保证了系统的高效性和低延迟性。基本的activity和fragment分别继承了对应的BaseBindingActivity和BaseBindingFragment，在绑定了对应xml视图和适配器的同时，实现了高内聚的设计原则和提高了代码的复用性。最后完成了对应的工具类的实现，便于数据的存储、消息的显示，符合设计原则中的单一职责，使代码更加清晰、可维护，并且提供了更好的复用性。完成了切换账号、退出登录、消息的通知和主题的切换。后端向前端发送请求用到了okhttp3。

## 五、实验创新点
1.结合百度地图SDK完成签到功能：
集成百度地图SDK：首先，根据所选的开发平台（如Android），下载并集成百度地图SDK到项目中。可以参考百度地图SDK提供的官方文档和示例代码进行集成。


获取用户位置信息：在签到功能中，需要获取用户的位置信息。使用百度地图SDK提供的定位功能，可以获取到用户的当前位置坐标（经纬度）。
显示地图界面：根据签到功能的需求，可以在应用中显示地图界面，以便用户进行位置确认和签到操作。使用百度地图SDK提供的地图控件，可以在界面上展示地图，并设置相应的配置参数。
定位功能：在地图界面上，使用百度地图SDK提供的定位功能，结合用户授权和权限管理，获取用户的当前位置坐标。
签到操作：在获取用户位置信息后，可以根据自定义的签到规则和位置判断逻辑，判断用户是否满足签到条件。例如，判断用户与指定签到地点的距离是否在指定范围内，最后判断当前的时间段是否有课程在上，有的话就会自动签到到对应的课程中取。
签到结果显示：根据签到操作的结果，可以在界面上显示相应的签到信息，如签到成功或签到失败，并展示相关提示信息。
数据存储和后续处理：根据实验要求，可以将签到记录存储到后端数据库中，以便后续查询和分析。
最后对应课程的教师会接收到对应的签到记录，可以对学生的出勤进行统计和记录。

![image](https://github.com/ShYyy121/OA/assets/145829122/a50ed2a1-5116-44fa-a729-5d0730cd155e)

2.使用Spring Secuity完成请求的过滤，保证了系统的安全性：


引入Spring Security依赖：在项目的构建文件（如pom.xml）中添加Spring Security的依赖，以便引入相关库和功能。
配置Spring Security：创建一个配置类，继承自WebSecurityConfigurerAdapter，并使用@Configuration注解标记。在配置类中，可以通过重写configure方法来配置Spring Security的行为。
配置身份验证和授权：在配置类中，可以定义用户身份验证的逻辑和授权规则。可以使用内存中的用户、数据库中的用户、LDAP等作为用户存储源。通过配置用户角色和权限，确保只有具备特定角色或权限的用户才能访问受限资源。
配置请求过滤器：通过重写configure方法中的http对象，配置请求的过滤规则。可以定义哪些URL需要进行身份验证，哪些URL可以匿名访问，以及使用什么样的身份验证方式（如基于表单的身份验证、HTTP基本认证等）。
最后实现了，只有学生分配user身份，老师是teacher，主管是admin，不同的角色拥有不同的权限，学生只能访问以/user开头的路径，老师、主管也是如此，保证了系统的安全性。
在实现此功能的时候，在后端要保存在登陆的时候发送过来的cookie，在通过资料的搜索发现，在okhttp3中CookieJar可以持久化保存，只要之后的每次请求都带上这个cookie就可以分配对应的权限。

![image](https://github.com/ShYyy121/OA/assets/145829122/149c83a3-3132-4ea8-bb41-88a46ac63445)

3.完成了课程申请的功能，在申请成功后显示到课程表中：
申请成功后的处理逻辑：在课程申请功能中，当申请成功时，获取到申请成功的课程信息。根据课程信息，可以创建一个课程对象，包含申请的课程名称、时间、地点等信息。
存储课程信息：将课程对象存储到数据库中，以便后续读取和显示。可以在数据库中创建一个课程表的表格，存储每个申请成功的课程信息。
课程表的显示：在课程表界面中，读取数据库中的课程信息，并将其显示在相应的时间和地点上。可以使用合适的UI控件（如表格、日历视图等）来展示课程表，并根据数据库中的课程信息填充相应的课程格子。
更新课程表：如果用户提交新的课程申请或者已有的课程申请发生变化，需要及时更新课程表。在申请成功后，根据数据库中存储的课程信息，更新课程表的显示。
课程冲突处理：在将课程显示到课程表中时，需要注意处理课程冲突的情况。如果新的课程与已有的课程时间发生冲突，需要进行冲突检测并作出相应的处理，如提示用户或调整课程表的显示。

![image](https://github.com/ShYyy121/OA/assets/145829122/692ddc37-0401-40b8-9b46-09dd58313c65)

4.登录和注册后，密码的加密：
加密密码的方法，使用SHA-256哈希算法对密码进行加密。以下是对该方法的解释：
首先，通过调用MessageDigest.getInstance("SHA-256")获取一个SHA-256消息摘要实例。SHA-256是一种常用的密码散列函数，用于将输入数据（在这里是密码）转换为固定长度的哈希值。
digest.digest(password.getBytes(StandardCharsets.UTF_8))使用SHA-256算法对密码的字节数组进行摘要计算，得到加密后的哈希值。digest对象的digest()方法接收字节数组作为输入，并返回加密后的字节数组。
接下来，通过遍历加密后的字节数组，将每个字节转换为十六进制字符串，并将它们连接起来。这是通过StringBuilder对象的追加操作完成的。
最后，通过调用hexString.toString()将StringBuilder对象转换为最终的加密密码字符串，并返回。
但是这个加密方法是不可逆的，所以只能加密不能解密。

![image](https://github.com/ShYyy121/OA/assets/145829122/c6936d38-7ea6-4974-92cd-2a7240f9a30f)



5.在进入App后，系统会首先读取数据库中上一次登陆的记录，用对应的账号完成自动登录：

![image](https://github.com/ShYyy121/OA/assets/145829122/57b3633b-3a61-40b8-94a7-13a1d3c2fe20)

6.课程的整套流程的实现，从课程的申请到免修的申请：

![image](https://github.com/ShYyy121/OA/assets/145829122/2483d777-5e8e-48ef-93b5-21a04a975425)


## 六、实验总结
在实验过程中，我首先进行了系统的需求分析和设计。根据实验要求，我们设计了在线课程申请模块和在线审批模块的功能，并结合数据库进行了数据的存储和访问设计。另外，为了满足系统的健壮性、兼容性和通用性，我们根据实验要求拓展了系统的功能，并对系统的安全性进行了保障。
在后端开发方面，我选择了Spring Boot和Mybatis作为开发框架，采用MySQL作为数据库存储数据。通过Spring Security完成请求的过滤，确保了系统的安全性，并利用后端提供的数据访问的API和接口访问功能，实现了与前端的数据交互和通信。
在前端设计方面，我根据实验要求设计了基本的界面和逻辑流程。利用SharedPreferences和SQLite数据库，实现了本地数据的存储和高效访问，提升了系统的性能和响应速度。同时，通过遵循相应的设计原则，将功能模块进行合理的划分和封装，提高了代码的复用性和可维护性。
在实验过程中，我也遇到了一些挑战，如系统安全性的设计、数据库的关联和查询、前后端数据的传输等。最后通过自己的不断查阅和请教，克服了种种困难和bug。
通过本次实验，我深入了解了安卓的基本的开发流程、相关知识和如何与后端交互的原理和实现以及Spring Boot框架的应用和配置，掌握了数据库设计和操作的技巧，提升了前端开发的能力和经验。同时，我们也学到了如何将实验设计原则应用于系统开发中，以保证系统的可维护性、可扩展性和安全性。
然而，在本次实验中仍存在一些改进的空间。例如，可以进一步优化系统的性能和响应速度，增加对异常情况的处理和友好的用户提示。此外，可以进一步完善系统的功能，如消息通知、个人设置等，以提升用户体验和系统的实用性。
总之，通过本次实验，我成功地开发了一套满足在线课程申请及审批需求的APP，并获得了宝贵的实践经验。在今后的学习中，我将运用所学知识和经验，不断提升自己的技能，为开发高质量的软件系统
